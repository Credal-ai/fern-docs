imports:
  common: ./common.yml
service:
  base-path: /v0/copilots
  auth: true
  endpoints:
    createCopilot:
      availability: pre-release
      path: /createCopilot
      method: POST
      docs: Create a new copilot. The API key used will be added to the copilot for future Requests
      request:
        name: CreateCopilotRequest
        body:
          properties:
            name:
              type: string
              docs: |
                A descriptive name for the copilot.
            description:
              type: string
              docs: |
                An in depth name for the copilot's function. Useful for routing requests to the right copilot.
            collaborators:
              type: list<common.Collaborator>
              docs: |
                A list of collaborator emails and roles that will have access to the copilot.
      response: CreateCopilotResponse
      examples:
        - name: Example0
          request:
            name: Customer Copilot
            description: This copilot is used to answer customer requests based on internal documentation.
            collaborators:
              - email: test@gmail.com
                role: editor
          response:
            body:
              agentId: "ac20e6ba-0bae-11ef-b25a-efca73df4c3a"

    createConversation:
      path: /createConversation
      method: POST
      docs: OPTIONAL. Create a new conversation with the Copilot. The conversation ID can be used in the `sendMessage` endpoint. The `sendMessage` endpoint automatically creates new conversations upon first request, but calling this endpoint can simplify certain use cases where it is helpful for the application to have the conversation ID before the first message is sent.
      request:
        name: CreateConversationRequest
        body:
          properties:
            agentId:
              type: uuid
              docs: |
                Credal-generated Copilot ID to specify which agent to route the request to.
            userEmail:
              type: string
              docs: |
                End-user for the conversation.
      response: CreateConversationResponse
      examples:
        - name: Example0
          request:
            agentId: 82e4b12a-6990-45d4-8ebd-85c00e030c24
            userEmail: ravin@credal.ai
          response:
            body:
              conversationId: "ac20e6ba-0bae-11ef-b25a-efca73df4c3a"
    provideMessageFeedback:
      path: /provideMessageFeedback
      method: POST
      request:
        name: ProvideMessageFeedbackRequest
        body:
          properties:
            agentId:
              type: uuid
              docs: |
                Credal-generated Copilot ID to specify which agent to route the request to.
            userEmail:
              type: string
              docs: |
                The user profile you want to use when providing feedback.
            messageId:
              type: uuid
              docs: |
                The message ID for which feedback is being provided.
            messageFeedback:
              type: MessageFeedback
              docs: |
                The feedback provided by the user.
      examples:
        - name: Example0
          request:
            userEmail: ravin@credal.ai
            messageId: dd721cd8-4bf2-4b94-9869-258df3dab9dc
            agentId: 82e4b12a-6990-45d4-8ebd-85c00e030c24
            messageFeedback:
              feedback: NEGATIVE
              suggestedAnswer: "Yes, Credal is SOC 2 compliant."

    sendMessage:
      path: /sendMessage
      method: POST
      request:
        name: SendMessageRequest
        body:
          properties:
            agentId:
              type: uuid
              docs: |
                Credal-generated Copilot ID to specify which agent to route the request to.
            message:
              type: string
              docs: |
                The message you want to send to your copilot.
            userEmail:
              type: string
              docs: |
                The user profile you want to use when sending the message.
            conversationId:
              type: optional<uuid>
              docs: |
                Credal-generated conversation ID for sending follow up messages. Conversation ID is returned after initial message. Optional, to be left off for first messages on new conversations.
            inputVariables:
              type: optional<list<InputVariable>>
              availability: in-development
              docs: |
                Optional input variables to be used in the message. Map the name of the variable to a list of urls.
      response: SendAgentMessageResponse
      examples:
        - name: Example0
          request:
            agentId: 82e4b12a-6990-45d4-8ebd-85c00e030c24
            message: Is Credal SOC 2 compliant?
            userEmail: ravin@credal.ai
            inputVariables: [
              {
              name: "input1", urls: ["https://drive.google.com/file/d/123456/view"],
              }, 
              {
              name: "input2", urls: ["https://drive.google.com/file/d/123457/view", "https://drive.google.com/file/d/123458/view"]
              }
            ]
          response:
            body:
              sendChatResult:
                type: ai_response_result
                conversationId: fc938005-92db-411a-88eb-32ca50d5f744
                policy_triggers: []
                response:
                  message: "Based on the context provided, Credal is SOC 2 compliant..."
                  dataChunk: "...SOC 2 is a technical audit that requires companies to establish and follow strict information security policies and procedures. Credal's SOC 2 report is available upon request..."
                warnings: []
                inserted_audit_log:
                  id: 5842804e-ffbe-4f8d-873e-f007fff93440
                referencedSources:
                  [
                    {
                      id: "1",
                      externalResourceId:
                        {
                          externalResourceId: "123456",
                          resourceType: "GOOGLE_DRIVE_ITEM",
                        },
                      name: "Example Document",
                      url: "https://drive.google.com/file/d/123456/view",
                    },
                  ]
                sourcesInDataContext:
                  [
                    {
                      id: "1",
                      externalResourceId:
                        {
                          externalResourceId: "123456",
                          resourceType: "GOOGLE_DRIVE_ITEM",
                        },
                      name: "Example Document",
                      url: "https://drive.google.com/file/d/123456/view",
                    },
                    {
                      id: "2",
                      externalResourceId:
                        {
                          externalResourceId: "123457",
                          resourceType: "GOOGLE_DRIVE_ITEM",
                        },
                      name: "Example Document 2",
                      url: "https://drive.google.com/file/d/123457/view",
                    },
                  ]
                webSearchResults: 
                  [
                    {
                      title: "SOC 2 Compliance",
                      url: "https://www.credal.ai/soc2",
                      content: "Credal is SOC 2 compliant. Learn more about SOC 2 compliance at Credal.",
                    },
                  ]
                messageId: dd721cd8-4bf2-4b94-9869-258df3dab9dc

    streamMessage:
      path: /streamMessage
      method: POST
      request:
        name: SendMessageRequest2
        body:
          properties:
            agentId:
              type: uuid
              docs: |
                Credal-generated Copilot ID to specify which agent to route the request to.
            message:
              type: string
              docs: |
                The message you want to send to your copilot.
            userEmail:
              type: string
              docs: |
                The user profile you want to use when sending the message.
            conversationId:
              type: optional<uuid>
              docs: |
                Credal-generated conversation ID for sending follow up messages. Conversation ID is returned after initial message. Optional, to be left off for first messages on new conversations.
            inputVariables:
              type: optional<list<InputVariable>>
              availability: in-development
              docs: |
                Optional input variables to be used in the message. Map the name of the variable to a list of urls.
      response-stream:
        type: StreamingChunk
        format: sse
      examples:
        - name: Example3
          request:
            agentId: 82e4b12a-6990-45d4-8ebd-85c00e030c24
            message: Is Credal SOC 2 compliant?
            userEmail: ravin@credal.ai
            inputVariables: [
              {
              name: "input1", urls: ["https://drive.google.com/file/d/123456/view"],
              }, 
              {
              name: "input2", urls: ["https://drive.google.com/file/d/123457/view", "https://drive.google.com/file/d/123458/view"]
              }
            ]
          response:
            stream:
              - event: initial_chunk
                data: 
                  test: hi
              - event: data_chunk
                data: 
                  test2: hellow
              - event: final_chunk
                data: 
                  test3: how are you

    addCollectionToCopilot:
      availability: pre-release
      path: /addCollectionToCopilot
      method: POST
      docs: Link a collection with a copilot. The API Key used must be added to both the collection and the copilot beforehand.
      request:
        name: AddCollectionToCopilotRequest
        body:
          properties:
            copilotId:
              type: uuid
              docs: |
                Credal-generated copilot ID to add the collection to.
            collectionId:
              type: uuid
              docs: |
                Credal-generated collection ID to add.
      examples:
        - name: Example0
          request:
            copilotId: 82e4b12a-6990-45d4-8ebd-85c00e030c24
            collectionId: def1055f-83c5-43d6-b558-f7a38e7b299e
          response:
            body:

    removeCollectionFromCopilot:
      availability: pre-release
      path: /removeCollectionFromCopilot
      method: POST
      docs: Unlink a collection with a copilot. The API Key used must be added to both the collection and the copilot beforehand.
      request:
        name: RemoveCollectionFromCopilotRequest
        body:
          properties:
            copilotId:
              type: uuid
              docs: |
                Credal-generated copilot ID to add the collection to.
            collectionId:
              type: uuid
              docs: |
                Credal-generated collection ID to add.
      examples:
        - name: Example0
          request:
            copilotId: 82e4b12a-6990-45d4-8ebd-85c00e030c24
            collectionId: def1055f-83c5-43d6-b558-f7a38e7b299e
          response:
            body:

    updateConfiguration:
      availability: pre-release
      path: /updateConfiguration
      method: POST
      docs: Update the configuration for a copilot
      request:
        name: UpdateConfigurationRequest
        body:
          properties:
            copilotId:
              type: uuid
              docs: |
                Credal-generated copilot ID to add the collection to.
            configuration:
              type: Configuration
      examples:
        - name: Example0
          request:
            copilotId: 82e4b12a-6990-45d4-8ebd-85c00e030c24
            configuration:
              name: Customer Copilot
              description: This copilot is used to answer customer requests based on internal documentation.
              prompt: You are a polite, helpful assistant used to answer customer requests.
              aiEndpointConfiguration:
                baseUrl: https://api.openai.com/v1/
                apiKey: <YOUR_API_KEY_HERE>
          response:
            body:

    deleteCopilot:
      availability: pre-release
      path: /deleteCopilot
      method: DELETE
      # docs: Delete copilot
      request:
        name: DeleteCopilotRequest
        body:
          properties:
            id:
              type: uuid
              docs: Copilot ID
      response: DeleteCopilotResponse
      examples:
        - name: Example0
          request:
            id: "ac20e6ba-0bae-11ef-b25a-efca73df4c3a"
          response:
            body:
              copilotId: "ac20e6ba-0bae-11ef-b25a-efca73df4c3a"

types:
  # CreateConversationRequest:
  #   properties:
  #     userEmail: string
  CreateConversationResponse:
    properties:
      conversationId: uuid

  SendAgentMessageResponse:
    properties:
      sendChatResult: SendMessageResponse

  SendMessageResponse:
    union:
      ai_response_result:
        type: MessageReply
        docs: |
          Returned when there is a reply
          fetched from the copilot.
      blocked_result:
        type: MessageBlocked
        docs: |
          Returned when Credal detects possible
          infosec violations and blocks the message.
  
  InputVariable:
    properties:
      name: string
      urls: list<string>

  MessageReply:
    properties:
      policy_triggers: list<PolicyTrigger>
      conversationId: uuid
      response: ResponseChunk
      warnings: list<string>
      inserted_audit_log: InsertedAuditLog
      referencedSources: list<ReferencedSource>
      sourcesInDataContext: list<ReferencedSource>
      webSearchResults: list<WebSearchResult>
      messageId: uuid

  ReferencedSource:
    properties:
      id: string
      externalResourceId: common.ExternalResourceId
      name: string
      url: optional<string>

  WebSearchResult:
    properties:
      title: string
      url: string
      content: string

  ResponseChunk:
    properties:
      message: string
      dataChunk: string

  InsertedAuditLog:
    properties:
      id: uuid

  MessageBlocked:
    properties:
      policy_triggers: list<PolicyTrigger>
      conversationId: uuid
      blocks: list<string>
      warnings: list<string>
      inserted_audit_log: InsertedAuditLog

  PolicyTrigger:
    properties:
      id: string
      name: string
      description: string

  FeedbackEnum:
    enum:
      - POSITIVE
      - NEGATIVE

  MessageFeedback:
    properties:
      feedback: FeedbackEnum
      suggestedAnswer: optional<string>

  Configuration:
    properties:
      aiEndpointConfiguration: optional<AIEndpointConfiguration>
      name: optional<string>
      description: optional<string>
      prompt: optional<string>

  AIEndpointConfiguration:
    properties:
      baseUrl: string
      apiKey: string

  CreateCopilotResponse:
    properties:
      agentId: uuid

  DeleteCopilotResponse:
    properties:
      copilotId: uuid
  
  InitialChunk:
    properties:
      test: string
  
  DataChunk:
    properties:
      test2: string
  
  FinalChunk:
    properties:
      test3: string

  StreamingChunk:
    discriminated: false
    union:
      - InitialChunk
      - DataChunk
      - FinalChunk